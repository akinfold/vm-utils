services:
  wgdashboard:
    image: shuricksumy/wgdashboard:latest
    restart: unless-stopped
    container_name: wgdashboard
    security_opt:
        - no-new-privileges:true
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.forwarding=1
      - net.ipv4.conf.all.src_valid_mark=1
    environment:
      - APP_PREFIX=/wg
      - TZ=$TZ
      - GLOBAL_DNS=8.8.8.8
      # - ENABLE=wg0,wg1,wg2
      # - PUBLIC_IP=192.168.88.88
    networks:
      wg:
        ipv4_address: 192.168.253.254
      traefik: {}
    ports:
      - $WG_PORT_RANGE:51820-51830/udp
    volumes:
      - $DOCKER_APPDATA_PATH/wgdashboard/wireguard:/etc/wireguard
      - $DOCKER_APPDATA_PATH/wgdashboard/scripts:/scripts
      - $DOCKER_APPDATA_PATH/wgdashboard/app_conf:/opt/wireguarddashboard/app/src/app_conf
      - $DOCKER_LOGS_PATH/wgdashboard:/opt/wireguarddashboard/app/src/log
    cap_add:
      - NET_ADMIN
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.wgdashboard.rule=Host(`$TRAEFIK_HOSTNAME`) && ( PathPrefix(`/wg`) || PathPrefix(`/static`) )"
      - "traefik.http.routers.wgdashboard.entrypoints=websecure"
      - "traefik.http.services.wgdashboard.loadbalancer.server.port=10086"
      # Middlewares
      - "traefik.http.routers.wgdashboard.middlewares=chain-basic-auth@file"
